!function(e,t,o,n,i,a,r,s){"use strict";const l=e=>o.getMessage("CODE_EDITOR."+e),d=function(){i.trace("Code Editor:",...arguments)},c=function(){i.warn("Code Editor:",...arguments)},u=function(){i.error("Code Editor:",...arguments)},g="is-active",m="sql",p="javascript",f="mle-javascript-snippet",h="mle-javascript-module",b="quicksql",_="file-urls-javascript",E="file-urls-css",C="html",y="plaintext",S="javascript",v="validate",I="dbHint",N="save-page",T="save-and-run-page",O=l("ACCESSIBILITY_MODE"),A=l("CLOSE"),L=l("FIND"),x=l("HINT"),M=l("INDENTATION"),k=l("INDENT_SIZE"),P=l("INDENT_WITH_TABS"),w=l("MINIMAP"),D=l("MINIMAP_CONDITIONAL"),R=l("QUERY_BUILDER"),q=l("REDO"),B=l("SETTINGS"),V=l("SHOW_LINE_NUMBERS"),F=l("SHOW_RULER"),z=l("SUGGESTIONS"),K=l("TAB_SIZE"),U=l("THEMES"),G=l("THEME_AUTOMATIC"),H=l("THEME_LIGHT"),$=l("THEME_DARK"),j=l("THEME_HIGH_CONTRAST_DARK"),W=l("TRANSFORM_CODE_CASE"),J=l("UNDO"),X=l("UTIL_OFF"),Z=l("UTIL_ON"),Q=l("VALIDATE"),Y=l("VALIDATION_SUCCESS"),ee=l("WHITESPACE"),te=l("BRACKET_PAIR_COLORIZATION"),oe=l("ROLE_DESCRIPTION"),ne=l("ROLE_DESCRIPTION_READONLY"),ie=l("PREVIOUS_CHANGE"),ae=l("NEXT_CHANGE"),re=o.getMessage("PD.SAVE_AND_RUN_PAGE"),se=o.getMessage("PD.SAVE");let le,de=!1;const ce={THEME:"theme",TABS_INSERT_SPACES:"tabsInsertSpaces",INDENT_SIZE:"indentSize",TAB_SIZE:"tabSize",RULER:"ruler",MINIMAP:"minimap",ACCESSIBILITY_MODE:"accessibilityMode",LINE_NUMBERS:"lineNumbers",WHITESPACE:"whitespace",SHOW_SUGGESTIONS:"showSuggestions",BRACKET_PAIR_COLORIZATION:"bracketPairColorization"},ue=[{label:G,value:"automatic"},{label:H,value:"vs"},{label:$,value:"vs-dark"},{label:j,value:"hc-black"}],ge="conditional",me=[{label:Z,value:"on"},{label:X,value:"off"},{label:D,value:ge}],pe=[{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"},{label:"8",value:"8"}],fe=[{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"},{label:"8",value:"8"}],he=i.getLevel()===i.LOG_LEVEL.OFF?".min":"",be=(()=>{const e=window.location,t=s.APEX_FILES[0];return"/"===t?e.protocol+"//"+e.host+s.APEX_FILES:"."===t?e.href.slice(0,e.href.lastIndexOf("/")+1)+s.APEX_FILES:s.APEX_FILES})(),_e=be+`libraries/monaco-editor/${apex.libVersions.monacoEditor}/min`,Ee=be+"libraries/monaco-editor-apex/custom-languages",Ce=`${be}libraries/monaco-editor-apex/quicksql${he}.js?v=${s.APEX_VERSION}`,ye="minimap",Se={NATIVE_NUMBER_FIELD:"numberFieldItem"},ve={NATIVE_FACETED_SEARCH:"facetsRegion",NATIVE_SMART_FILTERS:"facetsRegion",NATIVE_MAP_REGION:"mapRegion"},Ie=(()=>{const e={GLOBAL:{}};return{existsGlobally:t=>void 0!==e.GLOBAL[t],registerGlobally:(t,o)=>{e.GLOBAL[t]=o},disposeGlobally:t=>{e.GLOBAL[t]&&(e.GLOBAL[t].dispose(),delete e.GLOBAL[t])},deregisterEditor:t=>{if(e[t]){for(let o of Object.keys(e[t]))e[t][o].dispose(),delete e[t][o];delete e[t]}},existsForEditor:(t,o)=>e[t]&&void 0!==e[t][o],registerForEditor:(t,o,n)=>{e[t]=e[t]||{},e[t][o]&&e[t][o].dispose(),e[t][o]=n},disposeForEditor:(t,o)=>{e[t]&&e[t][o]&&(e[t][o].dispose(),delete e[t][o])}}})(),Ne=(()=>{const e=(()=>{const e={};let t;const o=e=>{if(![p,f,h].includes(e))throw new Error("Only JavaScript and MLE JavaScript are supported")};return{setContext:(n,i,a)=>{o(a),e[n]||(e[n]={code:null,model:null,lang:a}),e[n].code=i,t===a&&(e[n].model?e[n].model.setValue(i):e[n].model=monaco.editor.createModel(i,S)),d("CONTEXT_MANAGER added context",n)},dropContext:t=>{e[t]&&(e[t].model&&(e[t].model.dispose(),e[t].model=null),e[t]=void 0),d("CONTEXT_MANAGER dropped context",t)},_reevaluate:n=>{o(n),t=n,Object.keys(e).forEach((o=>{const n=e[o];t!==n.lang?n.model&&(n.model.dispose(),n.model=null):n.model?n.model.setValue(n.code):n.model=monaco.editor.createModel(e[o].code,S)})),d("CONTEXT_MANAGER contexts reevaluated")}}})(),t="once",o="fresh";let n;const i={[p]:{contexts:[{key:"DTS_JS",contentPath:be+"libraries/monaco-editor-apex/types/browser/types.d.ts?v="+s.APEX_VERSION,load:t,isLoaded:!1},{key:"JS_EXTRAS",contentFunction:e=>e?`\n                        declare namespace apex {\n                            var items: {\n                                ${e.items.map((e=>`${JSON.stringify(e.name)}: ${Se[e.type]||"item"};`)).join("\n")}\n                            };\n                            var regions: {\n                                ${e.regions.map((e=>`${JSON.stringify(e.staticId)}: ${ve[e.type]||"region"};`)).join("\n")}\n                            };\n                        }`:null,load:o}]},[f]:{contexts:[{key:"DTS_JS_MLE_SNIPPET_1",condition:s.DB_VERSION>=21,contentPath:`${be}libraries/monaco-editor-apex/types/mle/${s.DB_VERSION}/types.d.ts?v=${s.APEX_VERSION}`,load:t,isLoaded:!1},{key:"DTS_JS_MLE_SNIPPET_2",condition:s.DB_VERSION>=23,content:'\n                        import { defaultConnection, default as oracledb } from "mle-js-oracledb";\n                        globalThis.apex = {\n                            db: oracledb,\n                            conn: oracledb.defaultConnection(),\n                            env: {}\n                        };\n                    ',load:t,isLoaded:!1}]},[h]:{contexts:[{key:"DTS_JS_MLE_MODULE",condition:s.DB_VERSION>=23,contentPath:`${be}libraries/monaco-editor-apex/types/mle/${s.DB_VERSION}/types.d.ts?v=${s.APEX_VERSION}`,load:t,isLoaded:!1}]}};return{reevaluate:(a,r)=>{i[a].contexts.forEach((n=>{(void 0===n.condition||n.condition)&&(n.load===t&&!n.isLoaded||n.load===o)&&((async()=>{let t;if(n.content)t=n.content;else if(n.contentPath){const e=await fetch(n.contentPath);if(!e.ok)return void u("Could not fetch file",e);t=await e.text()}else n.contentFunction&&(t=n.contentFunction(r));e.setContext(n.key,t,a)})(),n.load===t&&(n.isLoaded=!0))})),n!==a&&(n=a,monaco.languages.typescript.javascriptDefaults.setCompilerOptions({target:monaco.languages.typescript.ScriptTarget.Latest,allowJs:!0,allowNonTsExtensions:!0,noLib:[f,h].includes(a)}),monaco.languages.typescript.javascriptDefaults.setDiagnosticsOptions({diagnosticCodesToIgnore:[1003]}),e._reevaluate(a))},setContext:e.setContext,dropContext:e.dropContext}})();function Te(e,t){return new Promise((o=>{[p,f,h].includes(e)?(Ne.reevaluate(e,t.pageInfo),o()):e===b?monaco.languages.getEncodedLanguageId(b)?o():r.loadScript({path:Ce},o):o()}))}function Oe(){monaco.languages.getLanguages().filter((e=>"sql"===e.id))[0].loader=()=>new Promise(((e,t)=>{require([`custom-languages/sql${he}`],e,t)})),monaco.editor.defineTheme("apex-vs",{inherit:!0,base:"vs",rules:[{token:"string.sql",foreground:"b26100"},{token:"keyword.sql",foreground:"c74634"},{token:"predefined.sql",foreground:"7e5e8a"},{token:"operator.sql",foreground:"000000"},{token:"atom.sql",foreground:"398459"},{token:"function.sql",foreground:"795E26"},{token:"pageitem.sql",foreground:"008080",fontStyle:"bold"},{token:"table.quicksql",foreground:"1E84BF",fontStyle:"bold"},{token:"view.quicksql",foreground:"008855",fontStyle:"bold"},{token:"list.quicksql",foreground:"b26100"},{token:"keywords.quicksql",foreground:"c74634"},{token:"types.quicksql",foreground:"398459"}],colors:{"editorBracketHighlight.foreground1":"#0431FA","editorBracketHighlight.foreground2":"#008000","editorBracketHighlight.foreground3":"#7B3814"}}),monaco.editor.defineTheme("apex-vs-dark",{inherit:!0,base:"vs-dark",rules:[{token:"string.sql",foreground:"ecbb76"},{token:"keyword.sql",foreground:"f14840"},{token:"predefined.sql",foreground:"a687b3"},{token:"operator.sql",foreground:"D4D4D4"},{token:"atom.sql",foreground:"259856"},{token:"function.sql",foreground:"DCDCAA"},{token:"pageitem.sql",foreground:"3dc9b0",fontStyle:"bold"},{token:"table.quicksql",foreground:"1E84BF",fontStyle:"bold"},{token:"view.quicksql",foreground:"259856",fontStyle:"bold"},{token:"list.quicksql",foreground:"ecbb76"},{token:"keywords.quicksql",foreground:"f14840"},{token:"types.quicksql",foreground:"A3CDFF"}],colors:{"editorBracketHighlight.foreground1":"#ffd700","editorBracketHighlight.foreground2":"#da70d6","editorBracketHighlight.foreground3":"#179fff"}}),monaco.editor.defineTheme("apex-hc-black",{inherit:!0,base:"hc-black",rules:[{token:"string.sql",foreground:"ecbb76"},{token:"keyword.sql",foreground:"f14840"},{token:"predefined.sql",foreground:"a687b3"},{token:"operator.sql",foreground:"D4D4D4"},{token:"atom.sql",foreground:"259856"},{token:"function.sql",foreground:"DCDCAA"},{token:"pageitem.sql",foreground:"3dc9b0",fontStyle:"bold"},{token:"table.quicksql",foreground:"1E84BF",fontStyle:"bold"},{token:"view.quicksql",foreground:"259856",fontStyle:"bold"},{token:"list.quicksql",foreground:"ecbb76"},{token:"keywords.quicksql",foreground:"f14840"},{token:"types.quicksql",foreground:"259856"}],colors:{"editorBracketHighlight.foreground1":"#ffd700","editorBracketHighlight.foreground2":"#da70d6","editorBracketHighlight.foreground3":"#87cefa"}}),[_,E].forEach((e=>{monaco.languages.register({id:e}),monaco.languages.setLanguageConfiguration(e,{comments:{lineComment:"--",blockComment:["/*","*/"]},brackets:[["[","]"]]}),monaco.languages.setMonarchTokensProvider(e,{tokenizer:{root:[{include:"@whitespace"},[/^\[.+?\]/,"variable"]],whitespace:[[/\/\*/,"comment","@comment"],[/^--.*$/,"comment"],[/#(MIN|MIN_DIRECTORY)#/,"string"],[/#(APEX|APP|WORKSPACE|PLUGIN|THEME|THEME_DB)_FILES#/,"string"],[/#APP_VERSION#/,"string"]],comment:[[/[^\/\*]+/,"comment"],[/\*\//,"comment","@pop"],[/[\/\*]/,"comment"]]}}),monaco.languages.registerCompletionItemProvider(e,{triggerCharacters:["#"],provideCompletionItems:function(e,t,o){if("#"===o.triggerCharacter){const o=e.getWordUntilPosition(t);return{suggestions:["#MIN#","#MIN_DIRECTORY#","#APEX_FILES#","#APP_FILES#","#WORKSPACE_FILES#","#PLUGIN_FILES#","#THEME_FILES#","#THEME_DB_FILES#","#APP_VERSION#"].map((e=>({label:e,insertText:e,kind:monaco.languages.CompletionItemKind.Keyword,range:{startLineNumber:t.lineNumber,endLineNumber:t.lineNumber,startColumn:o.startColumn-1,endColumn:o.endColumn}})))}}}}),monaco.languages.registerCompletionItemProvider(e,{triggerCharacters:["[",","," "],provideCompletionItems:function(t,o){const n=t.getLineContent(o.lineNumber),i=t.getWordUntilPosition(o);if(n.slice(0,o.column-1).startsWith("[")&&n.slice(o.column-1).includes("]")){if(e===_){let e=[];const t=n.match(/^\[(.*)\].*/);return t&&(e=t[1].split(",").map((e=>e.trim()))),{suggestions:[{label:"module",insertText:"module"},{label:"async",insertText:"async"},{label:"defer",insertText:"defer"},{label:"require requirejs",insertText:"require requirejs"},{label:"require jet",insertText:"require jet"},{label:"define",insertText:"define ${1:moduleName}=${2:globalObject}"}].filter((t=>!e.includes(t.label))).map((e=>({label:e.label,insertText:e.insertText,kind:monaco.languages.CompletionItemKind.Keyword,insertTextRules:e.insertText.includes("${")?monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet:void 0,range:{startLineNumber:o.lineNumber,endLineNumber:o.lineNumber,startColumn:i.startColumn,endColumn:i.endColumn}})))}}return e===E?{suggestions:[{label:"media",insertText:'media="${1}"',kind:monaco.languages.CompletionItemKind.Keyword,insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,range:{startLineNumber:o.lineNumber,endLineNumber:o.lineNumber,startColumn:i.startColumn,endColumn:i.endColumn}}]}:void 0}}})}))}const Ae=new Promise((e=>{new Promise((e=>{void 0===window.require?r.loadScript({path:_e+"/vs/loader.js"},e):e()})).then((()=>{!function(){window.MonacoEnvironment={getWorkerUrl:function(){return"data:text/javascript;charset=utf-8,"+encodeURIComponent(`\n                    self.MonacoEnvironment = {\n                        baseUrl: "${_e}"\n                    };\n                    importScripts("${_e}/vs/base/worker/workerMain.js");\n                `)}},require.config({paths:{vs:_e+"/vs","custom-languages":Ee},waitSeconds:0});let e,t=n.getLanguage().toLowerCase();["zh-tw","zh-cn"].includes(t)?e=t:(t=t.split("-")[0],["de","es","fr","it","ja","ko","ru"].includes(t)&&(e=t)),e&&require.config({"vs/nls":{availableLanguages:{"*":e}}})}(),require(["vs/editor/editor.main"],(()=>{Oe(),e()}))}))}));function Le(){return apex.builder?apex.builder.isBuilderDarkMode()?"vs-dark":"vs":window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"vs-dark":"vs"}function xe(e){let t;le=e,"automatic"===e?t=Le():["vs","vs-dark","hc-black"].includes(e)?t=e:(t=Le(),d(e+" is not a valid Monaco theme. Using automatic instead.")),Ae.then((()=>{monaco.editor.setTheme("apex-"+t)}))}function Me(){return/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)}function ke(){return Me()?monaco.KeyMod.WinCtrl:monaco.KeyMod.CtrlCmd}function Pe(e){if(!e)return e;function t(t,o){let i,a,r,s="";for(i=0;i<n.length;i++)a=n[i],r=e.slice(a.start,a.end+1),s+=a.ignore?r:o(r);return s}let o=function(e){let t=[],o=e.matchAll(/('|")[\s\S]*?(\1)/gm);for(let e of o)t.push({start:e.index,end:e.index+e[0].length,ignore:!0});return t}(e),n=function(e,t){let o=[],n=0;function i(e,t,n){o.push({start:e,end:t,ignore:n})}if(0===e.length)i(0,t,!1);else{for(let t=0;t<e.length;t++){let o=e[t];n<o.start&&i(n,o.start-1,!1),i(o.start,o.end,!0),n=o.end+1}n<t-1&&i(n,t,!1)}return o}(o,e.length-1),i=t(0,(function(e){return e.toLocaleLowerCase()}));return e!==i?i:t(0,(function(e){return e.toLocaleUpperCase()}))}apex.builder?e("body").on("apex-builder-theme-changed",(()=>{"automatic"===le&&xe("automatic")})):window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addListener((()=>{"automatic"===le&&xe("automatic")}));const we=e=>[p,f,h].includes(e)?S:e,De=(()=>{let t;const o=()=>["font-family","font-size","line-height","word-spacing","letter-spacing"].map((t=>e("body").css(t))).join("-");return t=o(),()=>{const e=o();t!==e&&(t=e,d("New font values detected. Remeasuring Monaco fonts."),monaco.editor.remeasureFonts())}})();e.widget("apex.codeEditor",{widgetEventPrefix:"codeEditor",options:{language:S,value:"",readOnly:!1,autofocus:!1,ariaLabel:"",errors:[],warnings:[],suggestions:null,pageInfo:{pageId:null,isPageDesigner:!0,isGlobalPage:!1,isDialogPage:!1,items:[],regions:[]},showSuggestions:!0,validatePageItems:!1,accessibilityMode:!1,minimap:ge,lineNumbers:!0,wordWrap:!1,scrollBeyondLastLine:!0,wordBasedSuggestions:!1,toolbar:!0,whitespace:!1,theme:"automatic",tabsInsertSpaces:!0,indentSize:"4",tabSize:"4",ruler:!1,bracketPairColorization:!1,onInitialized:null,codeComplete:null,validateCode:null,queryBuilder:null,heightFn:null,dialogSave:null,preferencesChanged:null,lazyLoad:!1,diffEditor:!1},_create:function(){const o=this,n=this.options,i=e(o.element[0]).addClass("a-MonacoEditor"),r=we(n.language);i.append(e(`\n                <div class="a-MonacoEditorContent">\n                    <div class="a-MonacoEditor-toolbar"></div>\n                    <div class="a-MonacoEditor-notification" style="display:none;">\n                        <div class="a-MonacoEditor-message"></div>\n                        <button title="${A}" aria-label="${A}" class="a-Button a-Button--noLabel a-Button--withIcon a-Button--small a-CodeEditor-searchBar-closeButton" type="button">\n                            <span class="a-Icon ui-icon-closethick" aria-hidden="true"></span>\n                        </button>\n                    </div>\n                    <div class="a-MonacoEditor-editor"></div>\n                </div>\n            `)),o.baseId=o.element[0].id,o._editor$=i,o._toolbar$=i.find(".a-MonacoEditor-toolbar"),o._notification$=i.find(".a-MonacoEditor-notification"),o._monacoEditor$=i.find(".a-MonacoEditor-editor").first(),(async()=>{n.lazyLoad&&(d("Loading halted",i),await new Promise((e=>{i.one("load-resume",(()=>{d("Loading resumed",i),e()}))}))),await Ae,await Te(o.options.language,o.options),n.toolbar&&(o._context=a.createContext("codeEditor",this.element[0]),o._initToolbar(o._toolbar$)),o._notification$.find("button").on("click",(()=>{o.resetNotification()})),xe(n.theme);const e={detectIndentation:!1,insertSpaces:n.tabsInsertSpaces,indentSize:n.indentSize,tabSize:n.tabSize,rulers:n.ruler?[80]:[],scrollBeyondLastLine:n.scrollBeyondLastLine,lineNumbers:n.lineNumbers,lineNumbersMinChars:4,scrollbar:{alwaysConsumeMouseWheel:!1},fixedOverflowWidgets:!0,ariaLabel:n.ariaLabel,wordBasedSuggestions:n.wordBasedSuggestions,quickSuggestions:n.showSuggestions,accessibilitySupport:n.accessibilityMode?"on":"off",renderWhitespace:n.whitespace?"all":"none",copyWithSyntaxHighlighting:!1,"bracketPairColorization.enabled":n.bracketPairColorization,mouseWheelZoom:!0,...o._getLanguageDependentMonacoOptions()};let s,l,c,u;if(n.diffEditor){const t=monaco.editor.createDiffEditor(o._monacoEditor$[0],{...e,alwaysRevealFirst:!0,renderSideBySide:!n.accessibilityMode}),i=monaco.editor.createModel(n.value.original,r),a=monaco.editor.createModel(n.value.modified,r);t.setModel({original:i,modified:a}),s=t.getModifiedEditor(),c=i,l=a,this._diffEditor=t,this._diffNavigator=monaco.editor.createDiffNavigator(t)}else l=monaco.editor.createModel(n.value,r),s=monaco.editor.create(o._monacoEditor$[0],e),s.setModel(l);o._model=l,o._modelOriginal=c,o._modelId=l.id,o._editor=s,o._editorId=s.getId(),o._setReadOnly(!!n.readOnly),s.onDidDispose((()=>{o._disposeAllDisposables(),l.dispose(),c?.dispose()})),o._evaluateContextKeys(n.language),n.toolbar&&(o._updateNotifications(),o._populateContext()),window.addEventListener("resize",t.debounce((()=>{o.resize()}),200)),i.on("resize",(function(e){o.resize(),e.stopPropagation()})),n.autofocus&&o.focus(),s.onKeyDown((e=>{o.element.children("textarea").trigger("keypress",e)})),s.onDidFocusEditorWidget((function(){u=l.getValue()})),s.onDidBlurEditorWidget((function(){let e=o.element.children("textarea"),t=l.getValue();e.trigger("blur"),u!==t&&e.val(t).trigger("change")})),n.validatePageItems&&n.pageInfo.pageId&&o._initializeItemValidator(),o._configureCustomSuggestionProvider(),o._initializeCustomActions(),o._setupMinimap();let g=monaco.editor.EditorOptions.accessibilitySupport.id;s.onDidChangeConfiguration((function(e){e.hasChanged(g)&&(n.accessibilityMode=s.getOption(g)===monaco.editor.AccessibilitySupport.Enabled,o._notifyPreferenceChange())})),o._monacoEditor$.on("change",(function(e){e.stopPropagation()})),void 0!==o._tempValue&&(o.setValue(o._tempValue),o._tempValue=void 0),s.onDidFocusEditorWidget((()=>{[p,f,h].includes(n.language)&&Ne.reevaluate(n.language,n.pageInfo),De()})),o._on(o._eventHandlers),o.resetUndoRedoStack(),n.onInitialized&&n.onInitialized(s)})()},_eventHandlers:{resize:function(e){this.resize(),e.stopPropagation()},focusin:function(){this.element.addClass(g)},focusout:function(){this.element.removeClass(g)}},_destroy:function(){this._editor&&this._editor.dispose()},_setOption:function(e,t){let o=this,n=o.options,i=o._editor;if(o._super(e,t),"readOnly"===e)o._setReadOnly(!!t);else if(["errors","warnings"].includes(e))o._updateNotifications();else if("language"===e)o._setLanguage(t);else if("tabsInsertSpaces"===e)i.updateOptions({insertSpaces:t});else if("ruler"===e)i.updateOptions({rulers:t?[80]:[]});else if("theme"===e)n.theme=t,xe(t);else if("minimap"===e)o._setupMinimap();else if("lineNumbers"===e)i.updateOptions({lineNumbers:!!t});else if("accessibilityMode"===e)i.updateOptions({accessibilitySupport:t?"on":"off"});else if("whitespace"===e)i.updateOptions({renderWhitespace:t?"all":"none"});else if("showSuggestions"===e)i.updateOptions({quickSuggestions:!!t});else if("bracketPairColorization"===e)i.updateOptions({"bracketPairColorization.enabled":!!t});else if("diffEditor"===e)throw new Error("Switching between regular editor and diffEditor is not supported.")},setValue:function(e){this.options.diffEditor&&this._modelOriginal&&this._model?(this._modelOriginal.setValue(e.original),this._model.setValue(e.modified)):!this.options.diffEditor&&this._model?this._model.setValue(e):this._tempValue=e},getValue:function(){return this.options.diffEditor&&this._modelOriginal&&this._model?{original:this._modelOriginal.getValue(),modified:this._model.getValue()}:!this.options.diffEditor&&this._model?this._model.getValue():void 0!==this._tempValue?this._tempValue:this.options.value},getEditor:function(){return this._editor},resize:function(){let e=this;e.options.heightFn&&e._editor$.outerHeight(e.options.heightFn()),e.options.diffEditor?e._diffEditor?.layout():e._editor?.layout()},getSelection:function(){return this._model.getValueInRange(this._editor.getSelection())},showNotification:function(e){let t=this._notification$.show().children().first().empty();"string"==typeof e?t.html(e):"object"==typeof e&&e instanceof jQuery?(t.empty(),t.append(e)):u("The notification message must be a string or a jQuery object"),this.resize()},resetNotification:function(){this.errors=[],this.warnings=[],this._notification$.hide().children().first().empty(),this.resize()},showSuccessNotification:function(e){this.showNotification(`<ul><li role="alert" class="is-success">${e}</li></ul>`)},focus:function(){this.element.addClass(g),this._editor.focus()},setCursor:function(e,t){this._editor.setPosition({lineNumber:e,column:t})},setCursorToEnd:function(e){let t=this._editor,o=this._model,n=o.getLineCount(),i=o.getLineMaxColumn(n);this.setCursor(n,i),e&&t.revealLine(n)},changeGeneration:function(){return this._model.getAlternativeVersionId()},isClean:function(e){return this._model.getAlternativeVersionId()===e},getPreferencesString:function(){let e=this.options,t={},o=Object.values(ce);for(let n=0;n<o.length;n++){let i=o[n];t[i]=e[i]}return JSON.stringify(t)},_undoRedoDisposable:void 0,resetUndoRedoStack:function(){const e=this,t=e._editor,o=e._model,n=e._context;e._undoRedoDisposable&&(e._undoRedoDisposable.dispose(),e._undoRedoDisposable=void 0),n?.disable("undo"),n?.disable("redo");let i=o.getAlternativeVersionId(),a=i,r=i;e._undoRedoDisposable=t.onDidChangeModelContent((()=>{const e=o.getAlternativeVersionId();e<a?(n?.enable("redo"),e===i&&n?.disable("undo")):(e<=r?e===r&&n?.disable("redo"):(n?.disable("redo"),a>r&&(r=a)),n?.enable("undo")),a=e}))},diffPrevious:function(){const e=this,t=e.options,o=e._diffEditor;t.accessibilityMode?o.diffReviewPrev():e._diffNavigator.previous()},diffNext:function(){const e=this,t=e.options,o=e._diffEditor;t.accessibilityMode?o.diffReviewNext():e._diffNavigator.next()},_setReadOnly:function(e){const t=this._editor;if(t){t.updateOptions({readOnly:e});const o=t.getDomNode().querySelector("textarea.inputarea");o&&(o.ariaReadOnly=e,o.ariaRoleDescription=e?ne:oe)}},_disposableExists:function(e){return Ie.existsForEditor(this._editorId,e)},_registerDisposable:function(e,t){Ie.registerForEditor(this._editorId,e,t)},_disposeDisposable:function(e){Ie.disposeForEditor(this._editorId,e)},_disposeAllDisposables:function(){Ie.deregisterEditor(this._editorId)},_triggerMonacoAction:function(e){const t=this._editor;this.focus(),t.trigger(null,e)},_configureCustomSuggestionProvider:function(){let e,t,o=this,n=o._editor,i=o.options,a=we(i.language),r=i.suggestions;if(r){if(Array.isArray(r))e=r;else{if("function"!=typeof r)return void u("Suggestions type not supported");e=r(a)}e=e.map((e=>(e.insertText=e.insertText||e.label,e))),o._registerDisposable("global-suggestions",monaco.languages.registerCompletionItemProvider(a,{provideCompletionItems:function(o,i){if(n.hasTextFocus()){t=o.getWordUntilPosition(i);const n=e.map((e=>(e.range={startLineNumber:i.lineNumber,endLineNumber:i.lineNumber,startColumn:t.startColumn,endColumn:t.endColumn},e.kind=monaco.languages.CompletionItemKind.Constructor,e)));return n.length?{suggestions:n}:void 0}}})),i.language===f&&o._registerDisposable("mle-env",monaco.languages.registerCompletionItemProvider(S,{triggerCharacters:["."],provideCompletionItems:function(o,i,a){if(n.hasTextFocus()&&a.triggerKind===monaco.languages.CompletionTriggerKind.TriggerCharacter&&"."===a.triggerCharacter&&o.getLineContent(i.lineNumber).substr(0,i.column-2).endsWith("apex.env")){t=o.getWordUntilPosition(i);const n=e.map((e=>(e.range={startLineNumber:i.lineNumber,endLineNumber:i.lineNumber,startColumn:t.startColumn,endColumn:t.endColumn},e.kind=monaco.languages.CompletionItemKind.Constructor,e)));return n.length?{suggestions:n}:void 0}}}))}},_setupMinimap:function(){const e=this,o=e.options,n=e._editor,i=e._model;function a(){n&&i&&!i.isDisposed()&&n.updateOptions({minimap:{enabled:"on"===o.minimap||o.minimap===ge&&i.getLineCount()>=100}})}e._disposableExists(ye)&&e._disposeDisposable(ye),o.minimap===ge&&e._registerDisposable(ye,i.onDidChangeContent(t.debounce(a,1e3))),a()},_normalizeNotificationObject:function(e){if("object"==typeof e)return e;if("string"==typeof e){const t={message:e},o=t.message.indexOf("ORA-06550");if(o>-1){const e=t.message.slice(o).match(/\d{1,}/g),n=parseInt(e[1],10),i=parseInt(e[2],10);isNaN(n)||(t.lineNumber=n),isNaN(i)||(t.columnNumber=i)}return t}throw new Error("error/warning must be an object or a string")},gotoPosition:function(e,t,o=!0){let n=this._editor;n&&(n.revealLineInCenter(e),n.setPosition({lineNumber:e,column:t}),o&&setTimeout((function(){n&&n.focus()}),100))},_updateNotifications:function(){let t=this,o=t.options,n=e("<ul/>");function i(o,i){const a=t._normalizeNotificationObject(o),r=e(`<li role="alert" class="${i}" style="cursor: pointer;"></li>`);a.lineNumber&&a.columnNumber?r.append(e(`<a data-line="${a.lineNumber}" data-column="${a.columnNumber}"></a>`).text(a.message)):r.text(a.message),n.append(r)}o.errors.forEach((e=>{i(e,"is-error")})),o.warnings.forEach((e=>{i(e,"is-warning")})),n.children().length?(t.showNotification(n),e("a[data-line]",n).on("click",(function(){t.gotoPosition(e(this).data("line"),e(this).data("column"))}))):t.resetNotification(),t._updateInlineMessages()},_updateInlineMessages:function(){let e=this,o=e.options,n=e._model,i=[];function a(o,n){const a=e._normalizeNotificationObject(o);var r;a.lineNumber&&a.columnNumber&&i.push({startLineNumber:a.lineNumber,endLineNumber:a.lineNumber,startColumn:a.columnNumber,endColumn:1e3,message:(r=a.message,t.stripHTML(r.match(/.*(ORA|PLS)-\d+:(?<msg>.*)/s)?.groups?.msg||r).trim()),severity:n})}o.errors.forEach((e=>{a(e,monaco.MarkerSeverity.Error)})),o.warnings.forEach((e=>{a(e,monaco.MarkerSeverity.Warning)})),monaco.editor.setModelMarkers(n,"lineMessages",i),i.length&&e.gotoPosition(i[0].startLineNumber,i[0].startColumn)},_queryBuilder:function(){let e=this.options.queryBuilder;e&&e(this,this.getValue())},_codeComplete:function(){if(!this.options.codeComplete||![m,f].includes(this.options.language))return;let e,o,n,i,a,r,s=this,l=s.options.language,d=s._editor,c=s._model,u=d.getPosition(),p=c.getLineContent(u.lineNumber),h=!1,b=s.element[0];if(e=function(e,t){for(;" "===e[t];)t-=1;t=e.lastIndexOf(" ",t)+1;let o=e.indexOf(" ",t);return-1===o&&(o=e.length),e.substring(t,o)}(p,u.column-1),o=e.split("."),l===m)1===o.length&&[":","&"].includes(e.charAt(0))?(h=!0,n=e.slice(1)):(i=o[o.length-2],a=o[o.length-3]);else if(l===f){if(3!==o.length||"apex"!==o[0]||"env"!==o[1])return void s._triggerMonacoAction("editor.action.triggerSuggest");h=!0,n=o[2],i=void 0,a=void 0}t.delayLinger.start("autocompleteSpinner",(function(){r=t.showSpinner(b)})),s.options.codeComplete({type:h?"item":"",search:h?n:o[o.length-1],parent:i,grantParent:a},(function(e){apex.util.delayLinger.finish("autocompleteSpinner",(function(){r&&(r.remove(),r=null)}));let t,o,n=monaco.languages.CompletionItemKind,i={template:n.Constructor,application_item:n.Constructor,page_item:n.Constructor,package:n.Constructor,procedure:n.Method,function:n.Function,constant:n.Constructor,variable:n.Constructor,type:n.Constructor,table:n.Constructor,view:n.Constructor,keyword:n.Constructor,sequence:n.Constructor},a=[];for(let n=0;n<e.length;n++){t=e[n];for(let e=0;e<t.completions.length;e++){o=t.completions[e];let n=o.r||o;a.push({label:o.d||o,insertText:n,detail:t.title,kind:i[t.type]})}}let l=!1;s._registerDisposable("ajax-suggestions",monaco.languages.registerCompletionItemProvider(c._languageId,{provideCompletionItems:function(){return s.element.hasClass(g)&&!l?(l=!0,a.length?{suggestions:a}:void 0):void 0}})),s._triggerMonacoAction("editor.action.triggerSuggest")}))},validateCode:function(){if(!this.options.validateCode)return;let o=this;o.options.validateCode(o.getValue(),(function(n){n=e.extend({},{errors:[],warnings:[]},n),o._setOption("errors",n.errors),o._setOption("warnings",n.warnings),de||0!==n.errors.length||0!==n.warnings.length||o.showSuccessNotification(t.escapeHTML(Y))})),de=!1},_notifyPreferenceChange:function(){let t=this.element[0];this._trigger("preferencesChanged",e.Event("click",{target:t}))},_populateContext:function(){let e=this,t=e.options,n=t.language,i=e._editor,a=e._model,r=e._context;function s(){a.updateOptions({insertSpaces:t.tabsInsertSpaces,tabSize:t.tabSize,indentSize:t.indentSize})}r.add([{name:"undo",action:function(){e._triggerMonacoAction("undo")}},{name:"redo",action:function(){e._triggerMonacoAction("redo")}},{name:"find",action:function(){e._triggerMonacoAction(t.readOnly?"actions.find":"editor.action.startFindReplaceAction")}},{name:"theme",get:function(){return t.theme},set:function(o){t.theme=o,xe(o),e._notifyPreferenceChange()},choices:ue},{name:"minimap",get:function(){return t.minimap},set:function(o){t.minimap=o,e._setupMinimap(),e._notifyPreferenceChange()},choices:me},{name:"tabs-insert-spaces",label:P,get:function(){return t.tabsInsertSpaces},set:function(o){t.tabsInsertSpaces=o,s(),e._notifyPreferenceChange()}},{name:"tab-size",get:function(){return t.tabSize},set:function(o){t.tabSize=o,s(),e._notifyPreferenceChange()},choices:pe},{name:"indent-size",get:function(){return t.indentSize},set:function(o){t.indentSize=o,s(),e._notifyPreferenceChange()},choices:fe},{name:"show-ruler",label:F,get:function(){return t.ruler},set:function(t){e._setOption("ruler",t),e._notifyPreferenceChange()}},{name:"line-numbers",label:V,get:function(){return t.lineNumbers},set:function(t){e._setOption("lineNumbers",t),e._notifyPreferenceChange()}},{name:"whitespace",label:ee,get:function(){return t.whitespace},set:function(t){e._setOption("whitespace",t),e._notifyPreferenceChange()}},{name:"show-suggestions",label:z,get:function(){return t.showSuggestions},set:function(t){e._setOption("showSuggestions",t),e._notifyPreferenceChange()}},{name:"accessibility-mode",label:O,get:function(){return t.accessibilityMode},set:function(o){e._setOption("accessibilityMode",o),e._notifyPreferenceChange(),t.diffEditor&&(e._diffEditor?._reviewPane?.hide(),e._diffEditor?.updateOptions({renderSideBySide:!o}))}},{name:"bracket-pair-colorization",label:te,get:function(){return t.bracketPairColorization},set:function(t){e._setOption("bracketPairColorization",t),e._notifyPreferenceChange()}}]),t.queryBuilder&&r.add({name:"query-builder",hide:n!==m,action:function(){e._queryBuilder()}}),t.codeComplete&&(r.add({name:"code-complete",hide:![m,f].includes(n),action:function(){e._codeComplete()}}),i.addAction({id:"apex-code-complete",label:x,keybindings:[ke()|monaco.KeyCode.Space],precondition:I,run:function(){e._codeComplete()}})),t.validateCode&&(r.add({name:"validate",hide:!this._hasValidate(),action:function(){e.validateCode()}}),i.addAction({id:"apex-code-validate",label:Q,keybindings:[ke()|monaco.KeyMod.Alt|monaco.KeyCode.KeyV],precondition:v,run:function(){e.validateCode()}})),t.diffEditor&&r.add([{name:"diff-previous",action:function(){e.diffPrevious()},title:ie,label:ie,icon:"icon-prev-change",shortcut:"Alt+Shift+F5"},{name:"diff-next",action:function(){e.diffNext()},title:ae,label:ae,icon:"icon-next-change",shortcut:"Alt+F5"}]),t.dialogSave&&((t.pageInfo.isGlobalPage||t.pageInfo.isDialogPage)&&t.pageInfo.isPageDesigner||!t.pageInfo.isPageDesigner?(r.add({name:N,action:function(e,o){de=!0,t.dialogSave(e,o)}}),i.addAction({id:"apex-"+N,label:o.format(se,[]),keybindings:[monaco.KeyMod.Alt|monaco.KeyCode.F8,monaco.KeyMod.Alt|monaco.KeyCode.F7],run:function(e){de=!0,t.dialogSave({},e.getDomNode())}})):(r.add({name:T,action:function(e,o){de=!0,t.dialogSave(e,o,!0)}}),i.addAction({id:"apex-"+T,label:o.format(re,[]),keybindings:[monaco.KeyMod.Alt|monaco.KeyCode.F7,monaco.KeyMod.Alt|monaco.KeyCode.F8],run:function(e){de=!0,t.dialogSave({},e.getDomNode(),!0)}})))},_initToolbar:function(e){let t,n=this.options,i={actionsContext:this._context,simple:!0,data:[]};function a(e){return Me()?e.replace("Alt","Option").replace("Ctrl","Control"):e}let r=[];r.push({type:"BUTTON",title:J,label:J,iconOnly:!0,icon:"icon-undo",action:"undo"}),r.push({type:"BUTTON",title:q,label:q,iconOnly:!0,icon:"icon-redo",action:"redo"}),i.data.push({id:"undoControls",align:"start",groupTogether:!0,controls:r});let s=[];if(s.push({type:"BUTTON",title:L,label:L,iconOnly:!0,icon:"icon-cm-find",action:"find"}),i.data.push({id:"searchControls",align:"start",groupTogether:!0,controls:s}),n.queryBuilder||n.codeComplete||n.validateCode){let e={id:"helperControls",align:"start",groupTogether:!0,controls:[]};n.queryBuilder&&e.controls.push({type:"BUTTON",title:R,label:R,iconOnly:!0,icon:"icon-cm-query-builder",action:"query-builder"}),n.codeComplete&&(t=x+" - "+a("Ctrl+Space"),e.controls.push({type:"BUTTON",title:t,label:t,iconOnly:!0,icon:"icon-cm-autocomplete",action:"code-complete"})),n.validateCode&&(t=Q+" - "+a("Ctrl+Alt+V"),e.controls.push({type:"BUTTON",title:t,label:t,iconOnly:!0,icon:"icon-cm-validate",action:"validate"})),i.data.push(e)}if(n.diffEditor){const e={id:"diffControls",align:"end",groupTogether:!0,controls:[]};e.controls.push({type:"BUTTON",action:"diff-previous",icon:"x",iconOnly:!0}),e.controls.push({type:"BUTTON",action:"diff-next",icon:"x",iconOnly:!0}),i.data.push(e)}if(n.dialogSave){let e=[];(n.pageInfo.isGlobalPage||n.pageInfo.isDialogPage)&&n.pageInfo.isPageDesigner||!n.pageInfo.isPageDesigner?(t=o.format(se,"- "+a("Alt+F7")),e.push({type:"BUTTON",title:t,label:o.format(se,[]),iconOnly:!1,action:N})):(t=o.format(re,"- "+a("Alt+F8")),e.push({type:"BUTTON",title:t,label:o.format(re,[]),iconOnly:!1,iconBeforeLabel:!0,icon:"icon-run-page",action:T})),i.data.push({id:"saveControls",align:"end",groupTogether:!1,customCSS:"a-Button--toolbarOutline",controls:e})}i.data.push({id:"menuControls",align:"end",groupTogether:!1,controls:[{type:"MENU",title:B,label:B,iconOnly:!0,icon:"icon-gear",menu:{items:[{type:"subMenu",label:M,menu:{items:[{type:"toggle",action:"tabs-insert-spaces"},{type:"subMenu",label:K,menu:{items:[{type:"radioGroup",action:"tab-size"}]}},{type:"subMenu",label:k,menu:{items:[{type:"radioGroup",action:"indent-size"}]}}]}},{type:"subMenu",label:U,menu:{items:[{type:"radioGroup",action:"theme"}]}},{type:"subMenu",label:w,menu:{items:[{type:"radioGroup",action:"minimap"}]}},{type:"toggle",action:"accessibility-mode"},{type:"toggle",action:"line-numbers"},{type:"toggle",action:"show-ruler"},{type:"toggle",action:"show-suggestions"},{type:"toggle",action:"whitespace"},{type:"toggle",action:"bracket-pair-colorization"}]}}]}),e.toolbar(i),n.diffEditor&&e.find("button[data-action*='diff']").removeAttr("data-no-update")},_evaluateContextKeys:function(e){this._contextKeys||(this._contextKeys={});const t=this._contextKeys,o=this._editor;t[v]||(t[v]=o.createContextKey(v,!0)),t[I]||(t[I]=o.createContextKey(I,!0)),t[v].set(this._hasValidate()),t[I].set([m,f].includes(e))},_setLanguage:function(e){let t=this,o=t._model,n=t._editor,i=t.options,a=t._context,r=we(e);function s(e){a.lookup(e)&&a.hide(e)}function l(e){a.lookup(e)&&a.show(e)}monaco.editor.setModelMarkers(o,"lineMessages",[]),t.resetNotification(),t._configureCustomSuggestionProvider(),[m,f].includes(e)?l("code-complete"):s("code-complete"),e===m?l("query-builder"):s("query-builder"),this._hasValidate()?l("validate"):s("validate"),t._evaluateContextKeys(e),Te(e,i),monaco.editor.setModelLanguage(o,r),n.updateOptions(t._getLanguageDependentMonacoOptions())},_hasValidate:function(){const e=this.options,t=e.language;return[m,C,f].includes(t)&&void 0!==e.validateCode},_initializeItemValidator:function(){let e=this._model,n=this.options,i=n.pageInfo.pageId,a=new RegExp("P("+i+"|0)_[A-Z0-9_]*","gi"),r=[],s=n.pageInfo.items.map((e=>e.name.toLowerCase())),l=t.debounce((function(){if(r=[],e&&!e.isDisposed()){const t=e.getLineCount();for(let n=1;n<=t;n++){const t=e.getLineContent(n).matchAll(a);for(let e of t){let t=e[0].toLowerCase(),i=e.index+1;s.includes(t)||r.push({startLineNumber:n,endLineNumber:n,startColumn:i,endColumn:i+t.length,message:o.formatMessage("CODE_EDITOR.ITEM_DOES_NOT_EXIST",t.toUpperCase()),severity:monaco.MarkerSeverity.Warning})}}monaco.editor.setModelMarkers(e,"itemValidations",r)}}),100);e.onDidChangeContent(l),l()},_initializeCustomActions:function(){let e=this,t=e._editor,o=e._model,n=ke();function i(e,o){let n=t.getAction(e);t.addAction({id:e,label:n.label,alias:n.alias,keybindings:[o],run:function(){n.run()}})}i("editor.action.transformToUppercase",n|monaco.KeyMod.Alt|monaco.KeyCode.KeyU),i("editor.action.transformToLowercase",n|monaco.KeyMod.Alt|monaco.KeyCode.KeyL),e.options.diffEditor&&(delete t._actions["editor.action.diffReview.prev"],delete t._actions["editor.action.diffReview.next"]),t.addAction({id:"editor.action.toggleSmartCase",label:W,alias:W,keybindings:[n|monaco.KeyMod.Alt|monaco.KeyCode.KeyC],run:function(){let e=t.getSelections();if(!e.length)return;if(!o)return;let n=[];for(let t=0;t<e.length;t++){let i=e[t];if(!i.isEmpty()){let e=Pe(o.getValueInRange(i));n.push({range:i,text:e})}}t.pushUndoStop(),t.executeEdits(null,n),t.pushUndoStop()}}),t.addCommand(monaco.KeyMod.CtrlCmd|monaco.KeyMod.Shift|monaco.KeyCode.KeyP,(()=>{e._triggerMonacoAction("editor.action.quickCommand")}))},_getLanguageDependentMonacoOptions:function(){const e=this.options,t=we(e.language);return{wordWrap:e.language===y||(e.wordWrap?"on":"off"),useTabStops:e.language!==m,suggest:t===S?{showFiles:!1}:void 0}}}),e.apex.codeEditor=e.apex.codeEditor||{},e.apex.codeEditor.LANG_SQL=m,e.apex.codeEditor.LANG_JAVASCRIPT=p,e.apex.codeEditor.LANG_JAVASCRIPT_MLE_SNIPPET=f,e.apex.codeEditor.LANG_JAVASCRIPT_MLE_MODULE=h,e.apex.codeEditor.LANG_CSS="css",e.apex.codeEditor.LANG_FILE_URLS_JAVASCRIPT=_,e.apex.codeEditor.LANG_FILE_URLS_CSS=E,e.apex.codeEditor.LANG_HTML=C,e.apex.codeEditor.LANG_XML="xml",e.apex.codeEditor.LANG_QUICKSQL=b,e.apex.codeEditor.LANG_PLAINTEXT=y,e.apex.codeEditor.registerJavaScriptContextCode=Ne.setContext,e.apex.codeEditor.deregisterJavaScriptContextCode=Ne.dropContext,e.apex.codeEditor.preferencesObjectFromString=function(e){let t,o={};if(!e)return{};try{t=JSON.parse(e)}catch(e){return c("Could not parse optionsString"),{}}return Object.values(ce).forEach((e=>{let n=t[e],i=e;if(i===ce.THEME){if(!ue.map((e=>e.value)).includes(n))return void c("Bad theme ignored: "+n)}else if([ce.INDENT_SIZE,ce.TAB_SIZE].includes(i)){if(!["2","3","4","8"].includes(n))return void c("Bad number ignored: "+n)}else if("minimap"===i){if(!me.map((e=>e.value)).includes(n))return void c("Bad minimap ignored: "+n)}else{if(![ce.TABS_INSERT_SPACES,ce.RULER,ce.ACCESSIBILITY_MODE,ce.LINE_NUMBERS,ce.WHITESPACE,ce.SHOW_SUGGESTIONS,ce.BRACKET_PAIR_COLORIZATION].includes(i))return void c("Unknown preference: "+i);n=!!n}o[i]=n})),o}}(apex.jQuery,apex.util,apex.lang,apex.locale,apex.debug,apex.actions,apex.server,apex.env);